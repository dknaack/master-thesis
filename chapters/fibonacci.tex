\chapter{Higher-Order Fibonacci Numbers and their Golden Ratios}
\label{ch:fibonacci}

% TODO: Add reference to Fibonacci numbers in the continued fraction chapter
One of the simplest periodic continued fraction is $[1; \overline{1}]$.
This fraction evaluates to the golden ratio and its convergents are ratios of
consecutive Fibonacci numbers.
Naturally, we can consider the simplest vectors $x ∈ ℝ^d$ for the generalized
Euclidean algorithm, where the integer part in each iteration is $1$.
Such vectors can be seen as a generalization of the golden
ratio to higher dimensions and their approximation can be seen as a
generalization of Fibonacci numbers.
However, there does not exist a single definitive golden ratio,
Since the generalized algorithm allows an additional freedom in the choice of the pivot.
So there are actually multiple different possible definitions.
Some of these are well known, like the supergolden ratio or the plastic ratio,
which are both roots of cubic polynomials.

Since the definition of the golden ratios depends entirely on the choice of our
pivot element $x_ℓ$, we consider two strategies for choosing $x_ℓ$ in this
chapter: First choosing the smallest fractional value $\{x_ℓ\}$ and second
choosing the largest fractional value $\{x_ℓ\}$.
Both of these strategies have a respective golden ratio for which the algorithm
becomes periodic and they each have a corresponding linear recurrence, which
can be seen as a generalization of the Fibonacci numbers.
In the end, we will derive a general definition of higher-order Fibonacci
sequences and show that the generalized Euclidean algorithm is periodic for
their golden ratios.

% ==============================================================================
\section{The Classical Case: Fibonacci Numbers and the Golden Ratio}
% ==============================================================================

We revisit the classical case of Fibonacci numbers and the golden ratio
to understand their relationship with the Euclidean algorithm.
Fibonacci numbers are a recursive sequence.
Starting with the initial conditions $F(0) = 1$ and $F(1) = 1$,
the remaining terms are calculated using the formula
\[
  F(n) = F(n-1) + F(n-2).
\]
The first terms of this sequence are $1, 1, 2, 3, 5, 8, 13, 21, …$

Their relationship with the Euclidean algorithm becomes apparent when analyzing
the runtime of the algorithm.
In fact, the analysis was actually one of the first practical application of
the Fibonacci numbers.
Lamé \cite{Lame44} used the Fibonacci numbers to show that the number of
iterations in the Euclidean algorithm is bounded by the number of digits in the
input.
The proof is considered by some as the beginning of computational
complexity theory.

\begin{theorem}
  \label{thm:lame}
  If the Euclidean algorithm requires $n$ steps for $(a, b) ∈ ℤ_{> 0}^2$ with $a < b$,
  then $a ≥ F(n+2)$ and $b ≥ F(n+1)$.
\end{theorem}

\begin{proof}
  For $n = 0$, we have $F(2) = 2$ and $F(2) = 1$
  and they are the smallest pair of positive integers which require one step of
  the Euclidean algorithm.
  In fact, they are the smallest pair which satisfy $a < b$.
  So any pair, which takes only one step, must satisfy $a ≥ F(2)$ and $b ≥ F(1)$.
  Suppose that the theorem holds for some $n ≥ 0$.
  Let $(a, b)$ be an input which requires $n+1$ steps.
  Then, $a = qb + r$ for some integers $q, r ≥ 1$.
  For the pair $(b, r)$, the algorithm requires $n$ steps, so $b ≥ F(n+2)$ and
  $r ≥ F(n+1)$ by induction.
  But then
  \[
    a = qb + r ≥ F(n+2) + F(n+1) = F(n+3).
  \]
  Therefore, the theorem also holds for $n+1$.
\end{proof}

The theorem also follows easily using the continued fraction of the ratios
between Fibonacci numbers.
Given a finite continued fraction $[a₀; a₁, …, a_n]$, the Euclidean algorithm
requires $n$ steps for any input $(a, b)$ with the same ratio $a/b$ as the
continued fraction.
Since $[1; 1, …, 1] = F(n+1)/F(n)$ for some $n ≥ 0$, the Euclidean algorithm
takes at least $n$ steps for two consecutive Fibonacci numbers.
Furthermore, Fibonacci numbers are the smallest numbers which require $n$ steps
since we can only increase the coefficients of the continued fraction.

The continued fractions also show the connection between the Fibonacci numbers
and the golden ratio.
The convergents of the continued fraction $[1; \overline{1}]$ are ratios
between consecutive Fibonacci numbers $F(n+1)/F(n)$ and as $n$ approaches
infinity the convergents tend towards the golden ratio $φ$.

\iffalse
\begin{example}
  Consider $a = 13$ and $b = 8$.
  The algorithm proceeds as follows:
  \[
    \begin{array}{rclcrcl}
      13/8 & = & 1 & · & 5/8 & + & 3/8 \\
       5/8 & = & 1 & · & 3/8 & + & 2/8 \\
       3/8 & = & 1 & · & 2/8 & + & 1/8 \\
       2/8 & = & 2 & · & 1/8 & + & 0.
    \end{array}
  \]
\end{example}
\fi

\begin{theorem}
  The ratios $\frac{F(n+1)}{F(n)}$ converge towards the golden ratio $φ$ as $n$ increases.
\end{theorem}

\begin{proof}
  First, we show that the ratios are converging by mapping it to the continued fraction $[1; \overline{1}]$.
  By Lemma~\ref{lem:cf-wallis}, we can calculate the convergents of the continued fraction as
  \[
    p_n = a_n p_{n-1} + p_{n-2}, q_n = a_n q_{n-1} + q_{n-2}.
  \]
  The continued fraction consists solely of ones,
  so the Fibonacci sequence and the sequence $p_n$ are identical.
  The same is true for $q_n$, but $q_{-1} = 0$ and $q_{-2} = 1$, so the sequence lags one step behind $p_n$.
  Therefore, the convergents are actually $F(n+1)/F(n)$.
  The convergence is already given by Lemma~\vref{lem:cf-approx},
  so all that remains to be shown is that they actually converge to the golden ratio $φ$.
  Suppose they converge to some different limit $φ'$
  \[
    φ' = \lim_{n → ∞} \frac{F(n+1)}{F(n)} = \lim_{n → ∞} 1 + \frac{F(n-1)}{F(n)} = 1 + \frac{1}{φ'}.
  \]
  Multiplying this equation by $φ'$ results in the defining polynomial of the golden ratio $φ$.
  Because the ratios are always positive, we must have $φ' = φ$.
\end{proof}

% TODO: Metallic means

In summary,
the defining property of Fibonacci numbers with respect to the Euclidean
algorithm is that they represent the worst-case for the algorithm.
At each step, they have a quotient of $1$, so they decrease slower than any other pair of integers.
Additionally, their ratios approximate the golden ratio,
which follows from the continued fraction.

% ==============================================================================
\section{Higher-Order Fibonacci Numbers for the Minimum Strategy}
% ==============================================================================

% TODO: There should be a discussion on what it even means to have a Fibonacci number in higher dimensions
% TODO: We should also discuss the thing about idempotence under the choice of the pivot.
% TODO: Should we have a discussion about why we choose this particular linear system.
% TODO: The discussion about the linear system should go in the generalized Euclidean algorithm chapter
% TODO: We should explain that very large values give the least decrease, but also give the most decrease in the following iteration

For the generalisation of Fibonacci numbers,
we must find a sequence which similarly has a quotient of $1$ at each iteration.
However, the problem is that no single definitive sequence can exist.
With the generalized Euclidean algorithm we have an additional choice with the
element we choose to pivot with.
Therefore, multiple different notions of Fibonacci numbers exist for this
algorithm.

% I would like a better explanation of what the goal of this section is
We begin by deriving the Fibonacci numbers for one particular strategy.
Recall that the determinant decreases by $\{x_ℓ\}$ in each iteration.
So the first strategy one may think of is to choose the index $ℓ$ with the
smallest fractional value.
After all, this gives us the largest decrease in the determinant over one iteration.
Locally, this would be the highest decrease we can achieve.
So we begin with this strategy and see how the Fibonacci numbers are defined.

% TODO: Actually explain how we derive the Fibonacci numbers for this strategy.
% TODO: Should we have a table for the Fibonacci numbers?
% TODO: What about adding references to their OEIS number?

% TODO: Maybe it's better to show the numbers in the ratios, since we explain
% that they approach some golden ratio anyways
\begin{table}[tbp]
  \caption{The first 10 $d$-bonacci numbers for $d = 1, …, 5$ and their golden ratios.}
  \label{tbl:min-fibonacci}
  \centering
  \input{tables/min-fibonacci}
\end{table}

\begin{definition}
  The Fibonacci numbers for the minimum strategy are defined as
  \begin{enumerate}
    \item $F(0) = F(1) = ⋯ = F(d) = 1$.
    \item $F(n + 1) = F(n) + F(n - 1) + ⋯ + F(n - d)$.
  \end{enumerate}
  For $d = 2, 3$ and $4$, they are also referred to as the Tribonacci, Tetranacci
  and Pentanacci numbers.
  In general, they are known as the $d$-bonacci numbers.
\end{definition}

For these numbers, we use the solution vector $x = (x₁, …, x_d)$ with
\[
  x_i = \frac{\sum_{k=0}^i F(n - i)}{F(n)}.
\]
Because $F(n) = F(n - 1) + ⋯ + F(n - d - 1) > F(n - 1) + ⋯ + F(n - i)$,
each $x_i$ is bounded between $1$ and $2$.
Thus, each $x_i$ has a fractional value of $1$.
The smallest one is $x₁$, so we pivot with $ℓ = 1$ first.
Let $x' = \mathrm{pivot}_ℓ(x)$, then the first value is
\begin{align*}
  x₁' &
  = \frac{1}{\{x₁\}}
  = \frac{1}{x₁ - 1}
  = \frac{F(n)}{F(n - 1)}
  = \frac{F(n - 1) + ⋯ + F(n - d)}{F(n)}.
\end{align*}
This equals the value of $x_d$, if we would have started with $F(n-1)$ instead of $F(n)$.
The other values in our input vector $x$ are calculated as follows:
\begin{align*}
  xᵢ'
  & = \frac{\{xᵢ\}}{\{x₁\}} = \frac{xᵢ - 1}{x₁ - 1} \\
  & = \frac{F(n - 1) + ⋯ + F(n - i)}{F(n + 1)} · \frac{F(n)}{F(n - 1)} \\
  & = \frac{F(n - 1) + ⋯ + F(n - i)}{F(n - 1)}.
\end{align*}
So in the next iteration the value $x_i'$ has the same value as $x_{i-1}$, if we
would have started with $F(n - 1)$.
Therefore, in the next iteration the smallest fractional value must be $x_2$.
If we repeat this a total of $d$ times, then we end up where we started, but
each term is shifted backwards by $d$ steps.
To reach the end, we need a total $n$ steps.

% TODO: There should be a note, that we're taking the actual minimum, so we
% stop once we see any zero. Because at that point, we're cycling.

For the worst-case analysis, we first need the following lemma, which shows
that the $\mathrm{pivot}$ operation from Equation~\ref{eq:modified-update-rule}
can be viewed as a multi-dimensional division with remainder operation, where
we have a set of integers $p₁, …, p_d, q$ and divide them by one particular
element $p_ℓ$.

\begin{lemma}
  \label{lem:divmod}
  % TODO: This should basically prove that pivot is just division with
  % remainder
  Let $x = \left(\frac{p₁}{q}, \frac{p₂}{q}, …, \frac{p_d}{q}\right)$
  and $x' = \left(\frac{p₁'}{q'}, \frac{p₂'}{q'}, …, \frac{p_d'}{q'}\right)$
  with $x' = \mathrm{pivot}_ℓ(x)$ for some index $ℓ$.
  % TODO: Do we need gcd = 1?
  %Suppose $\gcd(q, p₁, …, p_d) = 1$ and $\gcd(q', p₁', …, p_d') = 1$, then
  Then,
  \[
    q = p_ℓ',
    \qquad
    p_ℓ = a_ℓ p_ℓ' + q',
    \qquad
    p_i = a_i p_ℓ' + p_i',
  \]
  for every $i ∈ \{1, …, d\}$ and $a = \floor{x}$.
\end{lemma}

\begin{proof}
  % TODO: Reference the rule
  By definition of $\mathrm{pivot}$, we have
  \[
    x_ℓ' = \frac{p_ℓ'}{q'} = \frac{1}{\frac{p_ℓ}{q} - a_ℓ} = \frac{q}{p_ℓ - a_ℓ q}.
  \]
  Therefore, $q = p_ℓ'$ and $p_ℓ = a_ℓ q + q' = a_ℓ p_ℓ' + q'$.
  For the remaining elements, we have
  \[
    \frac{p_i'}{q'} = \frac{\frac{p_i}{q} - a_i}{\frac{p_ℓ}{q} - a_ℓ} = \frac{p_i - a_i q}{p_ℓ - a_ℓ q}.
  \]
  Therefore, $p_i = p_i' + a_i q = p_i' + a_i p_ℓ'$.
\end{proof}

To show that the $d$-bonacci numbers are the worst-case for the minimum
strategy, we first need a few requirements.
The first is that the vector $x$ is strictly positive,
which can be easily solved by ignoring the first iteration.
In the second iteration, $x$ must always be positive.
The second requirement is that the values in $x$ are all different.
The reasoning behind this requirement is that one could easily check if there
are two elements $x_i, x_j$ with $x_i = x_j$.
Pivoting with either $ℓ = i$ or $ℓ = j$ removes the other element from the
vector, since the element will be zero in the next iteration.
Hence, this step will always be more efficient than pivoting a different element.
With these requirements, we can show that the $d$-bonacci numbers are the worst-case.

\begin{theorem}
  Let $x = (p₁/q, …, p_d/q) ∈ ℚ^d$.
  If the algorithm requires at least $n ≥ 0$ steps for the vector $x$ when
  taking the minimum fractional value at each step, then there exists a permutation $σ$ such
  that
  \[
    q ≥ F(n+d),
    \qquad
    p_{σ(i)} ≥ \sum_{k = 0}^i F(n+d - k),
    \text{ for every } i ≤ d.
  \]
\end{theorem}

\begin{proof}
  Suppose we require $n = 0$ steps.
  Since each value of $p₁, …, p_d, q$ must be distinct,
  there has to be one out of the $d+1$ integers,
  which is greater than $k$ for each $k ∈ \{1, …, d+1\}$.
  However, the first $d+1$ Fibonacci numbers have the values:
  \begin{align*}
    F(d) = 1,
    \qquad
    \sum_{k=0}^i F(d - k) = i + 1 \text{ for every } i ≤ d.
  \end{align*}
  Furthermore, the smallest value the denominator $q$ can assume is $1$.
  By ordering the elements accordingly,
  we can find a permutation $σ$ such that
  the bounds for this theorem are satisfied.

  % TODO: Fix indices
  Suppose the algorithm requires $n+1$ steps for some input $x = (p₁/q, …, p_d/q)$.
  Hence, $x' = \mathrm{pivot}_ℓ(x)$ requires $n$ steps and by induction,
  there exists a permutation $σ$ such that $q' ≥ F(n)$ and
  \begin{align*}
    p_{σ(i)}' & ≥ \sum_{k=0}^i F(n - k) = F(n + 1).
  \end{align*}
  We assume without loss of generality that $σ(d)$ is the largest element.
  Hence, we have to pivot with $ℓ = σ(d)$.
  Let $a = \floor{x}$, then $a_i ≥ 1$ by construction.
  From Lemma~\ref{lem:divmod}, it follows that
  \begin{align*}
    q        & = p_{σ(d)}' ≥ F(n+1),                                                   \\
    p_{σ(d)} & = a_{σ(d)} p_{σ(d)}' + q' ≥ F(n + 1) + F(n) = \sum_{k=0}^1 F(n + 1 - k) \\
    p_{σ(i)} & = a_{σ(d)} p_{σ(d)}' + p_{σ(i)}' ≥ F(n + 1) + ∑_{k=0}^i F(n - k) = ∑_{k=0}^{i+1} F(n + 1 - k).
  \end{align*}
  We construct a new permutation $σ'$ which orders the bounds correctly
  using $σ'(1) = σ(d)$ and $σ'(i) = σ(i+1)$ for the other indices.
\end{proof}

% TODO: Explain how this can be used to bound the time
Using the contrapositive of the theorem, it follows that if a vector $x$
has only one value smaller than the listed bounds, then it must take less than
$n$ steps.
Furthermore, we have seen that the Fibonacci numbers require exactly $n$ steps.
Therefore, these Fibonacci numbers are the worst-case input for the
minimum strategy.
This mirrors how classical Fibonacci numbers are the worst-case for the
classical Euclidean algorithm.

In the same spirit,
we can ask whether this generalization of Fibonacci also lead to a generalization of the golden ratio.
The classical Fibonacci numbers approach the golden ratio, when dividing consecutive numbers.
Therefore, we look at what values the $d$-bonacci numbers approach by dividing consecutive numbers.
This limit can be considered a multi-dimensional generalization of the golden ratio.
For now, we will assume that these ratios are converging.
A general proof of convergence will be shown in a later section.

\begin{theorem}
  If the ratios $\frac{F(n+1)}{F(n)}$ are converging, then they approach $φ$,
  where $φ$ is the positive real root of the polynomial $p(x) = x^{d+1} - x^d - ⋯ - 1$.
\end{theorem}
% TODO: Add note about convergence towards some sort of golden ratio

\begin{proof}
  By assumption, the ratios are approach some limit $r$.
  Then,
  \[
    r
    = \lim_{n → ∞} \frac{F(n+1)}{F(n)}
    = \lim_{n → ∞} \left(1 + \frac{F(n-1)}{F(n)} + \frac{F(n-2)}{F(n)} + ⋯ + \frac{F(n-d)}{F(n)}\right).
  \]
  Each ratio in the sum can be rewritten as a product of ratios with
  consecutive Fibonacci numbers, since
  \[
    \frac{F(n - i)}{F(n)}
    = \frac{F(n - i)}{F(n - i + 1)} · \frac{F(n - i + 1)}{F(n - i + 2)} ⋯ \frac{F(n - 1)}{F(n)}.
  \]
  By assumption, each ratio approaches $L^{-1}$ as $n$ increases towards infinity.
  Therefore,
  \[
    r = 1 + \frac{1}{r} + \frac{1}{r^2} + ⋯ + \frac{1}{r^d},
  \]
  which is equivalent to $r^{d+1} - r^d - ⋯ - r - 1 = 0$.
  Furthermore, the ratios are always positive.
  Hence, $r = φ$.
\end{proof}

\begin{corollary}
  The ratios $F(n + i)/F(n)$ converge towards $φ^i$ for any $i ≥ 0$.
\end{corollary}

We can then replace the ratios in the solution vector $x$ with the actual golden ratio $φ_d$.
We now have an algebraic vector $x = (x₁, …, x_d) ∈ ℝ^d$ with
\[
  x_i
  = \lim_{n → ∞} \sum_{k=0}^i \frac{F(n - i)}{F(n)}
  = \sum_{k=0}^i φ^k.
\]
Importantly, the algorithm is periodic for this input vector.
We have already seen for the approximate solution with Fibonacci numbers
that $d$ steps shifts each number backwards by $d$.
For the algebraic solution, this means that it stays the same after $d$ steps.

\begin{theorem}
  The generalized Euclidean algorithm is periodic for the real vector $x = (x₁, …, x_d)$
  with $x_i = \sum_{k=0}^i φ^k$ when taking the minimum fractional value.
\end{theorem}

\begin{proof}
  %The integer part of each $x_i$ is still $1$.
  The first value $x₁$ is the smallest again, so $ℓ = 1$.
  In the following iteration, we have
  \[
    x_i' = \frac{\{x_i\}}{\{x_1\}} = \frac{φ + φ^2 + ⋯ + φ^i}{φ} = 1 + φ + ⋯ + φ^{i-1} = x_{i-1}.
  \]
  and
  \[
    x_1' = \frac{1}{\{x_1\}} = \frac{1}{φ} = 1 + φ + ⋯ + φ^d = x_d.
  \]
  Therefore, we reach the original input vector after $d$ iterations.
\end{proof}

% TODO: What property do the ratios have? Are they similar to the golden ratio?

\iffalse
% ==============================================================================
\section{Higher-Order Fibonacci Numbers for the Maximum Strategy}
% ==============================================================================

Choose the maximum fractional value, but never the actual maximum value.
The reason behind the latter is that the maximum value is always the previous
pivot element.
Therefore, if we choose the same maximum element, we could end up choosing the
same index over and over again.
Hence, we remove this index from the consideration and only look at the maximum
fractional value without the actual maximum.

If we have a vector $x ∈ ℚ$, then pivoting with this strategy must result in a
vector $x'$, where exactly one value is greater than $1$.
Because $\{x_ℓ\}$ is the maximum, every other element has a smaller fractional
value and $\{x_i\}/\{x_ℓ\}$ is smaller than $1$.
For the analysis, we assume the same for the initial vector $x$.
If $x$ does not satisfy these conditions, then we can iterate once and it has
to satisfy them.

The worst-case for this strategy are called maximum Fibonacci numbers and they
are defined by the following recurrence relation:
\begin{align*}
  F(n) =
  \begin{cases}
    1, & \text{ if } n ≤ 0, \\
    F(n - 1) + F(n - 1 - d), & \text{ if } n > 0.
  \end{cases}
\end{align*}
The first few terms of this sequences for different dimensions are listed in
Table~\ref{tbl:max-fibonacci}.

\begin{table}[tbp]
  \caption{The first 10 Fibonacci numbers for $d = 1, …, 5$ and their respective golden ratio.}
  \label{tbl:max-fibonacci}
  \centering
  \input{tables/max-fibonacci}
\end{table}

To construct the solution vector $x$ for these numbers, we choose a consecutive
ratio of two Fibonacci numbers for each $x_i$, where the index $i$ determines
the distance between the two.
More specifically, we choose the vector
\begin{align*}
  x = \left(
    \frac{F(n-1)}{F(n)},
    \frac{F(n-2)}{F(n)},
    …,
    \frac{F(n-(d-1)}{F(n)},
    \frac{F(n-d) + F(n)}{F(n)} \right).
\end{align*}

This time, we pivot with the largest fractional value, which is $x_1$.
Let $a = \floor{x}$, then the next vector is $x' = (x₁', …, x_d')$ where
the first element is
\begin{align*}
  x_1'
  = \frac{1}{\left\{\frac{F(n-1)}{F(n)}\right\}}
  = \frac{F(n)}{F(n-1)}
  = \frac{F(n-1) + F(n-1-d)}{F(n)},
\end{align*}
the elements with $i ≤ d - 1$ are
\begin{align*}
  x_i'
  = \frac{\frac{F(n-i)}{F(n)}}{\frac{F(n-1)}{F(n)}}
  = \frac{F(n-i)}{F(n-1)}
\end{align*}
and the last element is
\begin{align*}
  x_d'
  = \frac{\frac{F(n-d) + F(n)}{F(n)} - 1}{\frac{F(n-1)}{F(n)}}
  = \frac{F(n-d)}{F(n-1)}.
\end{align*}

\begin{theorem}
  Suppose the Euclidean algorithm requires at least $n$ steps for $x = (p₁/q, …, p_d/q)$
  with $0 < p₁ < ⋯ < p_{d-1} < q < p_d$ when taking the maximum fractional value at each step.
  Then, there exists a permutation $σ$ such that
  \[
    q ≥ F(n+d),
    \qquad
    p_{σ(d)} ≥ F(n + d) + F(n),
    \qquad
    p_{σ(i)} ≥ F(n + i)
    \quad
    \text{ for every } i ≤ d - 1.
  \]
\end{theorem}

\begin{proof}
  For $n = 0$, we have
  \[
    \left(\frac{F(2)}{F(1)}, \frac{F(3)}{F(1)}, …, \frac{F(d+1)}{F(1)} \right)
    = \left(\frac{2}{1}, \frac{3}{1}, …, \frac{d+1}{1} \right).
  \]
  This is the first positive input, which satisfies the ordering and it requires only one step.
  Therefore, any other input that requires one step must be larger.
  Now suppose that the theorem holds for any $n ≥ 0$.
  Let $x ∈ ℚ^d$ and $a = \floor{x}$.
  Suppose that $x' = \mathrm{pivot}_ℓ(x) = (p₁'/q', …, p_d'/q')$ requires at
  least $n$ steps, where $ℓ$ is chosen according to the strategy.
  By induction, there exists a permutation $σ$ such that
  \begin{align*}
    q'        & ≥ F(n),                     \\
    p_{σ(d)}' & ≥ F(n) + F(n - d) = F(n+1), \\
    p_{σ(i)}' & ≥ F(n - i)
    \text{ for every } i ≤ d - 1.
  \end{align*}
  We assume without loss of generality that $σ(i) = i$ and that it orders the elements in increasing order.
  Because $p_{σ(d)}$ is the largest element in $x'$, we have $ℓ = σ(d) = d$.
  However, $x_ℓ$ cannot be the largest element in $x$ because of the strategy.
  Therefore, $a_ℓ = 0$ and there exists another element $x_k$ with $k ≠ ℓ$ and $a_k ≥ 1$.
  Futhermore, that element must come before $x_ℓ$ since $ℓ = d$.
  We can now bound $x$ using $x'$ and Lemma~\ref{lem:divmod}:
  \begin{align*}
    q   & = p_ℓ' ≥ F(n+1), \\
    p_ℓ & = a_ℓ p_ℓ' + q' = q' ≥ F(n) ≥ F((n+1) - 1), \\
    p_k & = a_k p_ℓ' + p_k' ≥ p_ℓ' + p_k' ≥ F(n + 1) + F(n + 1 - (k + 1)), \\
    p_i & = a_k p_ℓ' + p_i' ≥ p_i' ≥ F(n - i) = F((n+1) - (i+1)).
  \end{align*}
  where $i < ℓ = d$ and $i ≠ k$.
  We're missing the bound for $F(n+1) + F(n+1 - d)$ and $F(n + 1 - k)$.
  The former follows from the bound of $p_k$.
  Because $k < ℓ$, we have
  \begin{align*}
    p_k & ≥ F(n + 1) + F(n + 1 - (k + 1)) ≥ F(n+1) + F(n+1 - d).
  \end{align*}
\end{proof}

% ==============================================================================
\section{Combining both Strategies into the Minimax Strategy}
% ==============================================================================

We choose two indices $k, ℓ$ at once such that they minimize $\{\{x_k\}/\{x_ℓ\}\}$.
We pivot with $k$ first to get $x'$, then with $ℓ$ to get $x''$.
It follows that:

\begin{itemize}
  \item $1/\{\{x_ℓ\}/\{x_k\}\}$ is the largest element in $x''$
  \item $\{\{x_ℓ\}/\{x_k\}\}$ is the smallest fractional value in $x'$
  \item $1/\{x_k\}$ is the largest element in $x'$
  \item $\{x_k\}$ has the largest fractional value in $x$
  \item $\{x_i\}/\{x_k\} < 1$ for every $i$.
\end{itemize}

For this strategy, we interleave the previous two sequences.
We have an even sequence $F_0$ and an odd sequence $F_1$,
which are defined as follows:
\begin{align*}
  F_1(n) & = F_0(n-1) + F_0(n-2) + ⋯ + F_0(n-d-1), \\
  F_0(n) & = F_1(n-1) + F_1(n-d-1).
\end{align*}

\begin{align*}
  \frac{F_1(n) + ∑_{k=0}^i F(n - k)}{F_1(n)}
  \frac{F_1(n)}{F}
\end{align*}

\begin{theorem}
  Let $x = (p₁/q, …, p_d/q) ∈ ℚ^d$ with distinct elements $p_i/q > 1$.
  If the algorithm requires $n ≥ 0$ steps for $x$ with the minimax strategy,
  then there exists a permutation $σ$ such that
  \[
    q ≥ F_1(n),
    \qquad
    p_{σ(i)} ≥ F_1(n) + \sum_{k=1}^i F_0(n - k).
  \]
\end{theorem}

\begin{proof}
  Suppose the algorithm requires $n$ steps for $x''$.
  By induction,
  \[
    q'' ≥ F_1(n),
    \qquad
    p_{σ(i)}'' ≥ ∑_{k=0}^i F_0(n - k).
  \]
  In the first iteration,
  $x_k$ has the largest fractional value.
  Therefore, $x_i' = \{x_i\}/\{x_k\}$ must be smaller than $1$ and $a_i' = 0$ for every $i ≠ k$.
  Furthermore, $x_k' = 1/\{x_k\}$ must be greater than $1$ and $a_k' ≥ 1$.
  By Lemma~\ref{lem:divmod},
  \begin{align*}
    q' & = p_ℓ'' ≥ F_0(n), \\
    p_ℓ' & = a_ℓ' p_ℓ'' + q'' ≥ q'' ≥ F_0(n), \\
    p_i' & = a_i' p_ℓ'' + p_i'' ≥ p_i'' ≥ \sum_{k=0}^i F_0(n - k), \\
    p_k' & = a_k' p_ℓ'' + p_k'' ≥ p_ℓ'' + p_k'' ≥ \sum_{k=0}^d F_0(n - k) = F_1(n+1).
  \end{align*}
  By assumption, every element $x_i$ in the initial input is greater than $1$ and
  so $a_i ≥ 1$ for every $i ∈ \{1, …, d\}$.
  Again by Lemma~\ref{lem:divmod},
  \begin{align*}
    q & = p_k' ≥ F_1(n + 1), \\
    p_k & = a_k' p_k' + q' ≥ p_k' + q' ≥ F_1(n+1) + F_0(n + 1 - 1), \\
    p_i & = a_i' p_k' + p_i' ≥ p_k' + p_i' ≥ F_1(n+1) + \sum_{k=1}^{i+1} F_0(n+1 - (i+1)).
  \end{align*}
\end{proof}

% TODO: Is the bound tight?

% ==============================================================================
\section{Higher-Order Fibonacci Sequences}
% ==============================================================================


%
% Periodicity
%


\begin{definition}
  A \emph{linear recurrence} with coefficients~$c_0, \dots, c_d ∈ ℤ_{≥ 0}$ is an equation
  \[
    F(n + 1) = c_0 F(n - d) + c_1 F(n - d + 1) + \dots + c_{d-1} F(n - 1) + c_d F(n).
  \]
\end{definition}

% begin periodicity
Given, the linear recurrence $F(n + d + 1) = F(n) + a_1 F(n - 1) + \dots + a_d F(n + d)$,
the value for $x_i^{(n)}$ in the solution $x^{(n)}$ is
\begin{equation}
  \label{eq:general-solution}
  x_i^{(n)} = \frac{F(n - i) + \sum_{k=1}^{i-1} a_{d-k} F(n - k)}{F(n)}.
\end{equation}

\begin{lemma}
  Pivoting with the first element of $x^{(n)}$ using the modified update rule yields the vector
  \[
    x' = (x^{(n-1)}_2, x^{(n-1)}_3, \dots, x^{(n-1)}_d, x^{(n-1)}_1).
  \]
\end{lemma}

\begin{proof}
  For $x_1$, we get
  \[
    \begin{aligned}
      \frac{1}{x_1}
      & = \frac{F(n)}{F(n - 1)} \\
      & = a_d + \frac{F(n - d - 1) + a_1 F(n - d - 2) + \dots + a_{d-1} F(n - 2)}{F(n - 1)} \\
      & = a_d + x^{(n-1)}_d.
    \end{aligned}
  \]
  For the other values, we get
  \begin{align*}
    \frac{x_i}{x_1}
    & = \frac{F(n - i) + \sum_{k=1}^{i-1} a_{d-k} F(n - k)}{F(n)} \frac{F(n)}{F(n - 1)} \\
    & = a_{d-1} + \frac{F(n - i) + \sum_{k=2}^{i-1} a_{d-k} F(n - k)}{F(n-1)} \\
    & = x^{(n-1)}_{i+1} \qedhere
  \end{align*}
\end{proof}

\begin{corollary}
  Running the generalized Euclidean algorithm with $x^{(n)}$ as the solution to
  the linear system $B x = c$ requires $n$ steps, if $x^{(n)}_1$ is the
  smallest element in $x^{(n)}$.
\end{corollary}

Of course, the Euclidean algorithm receives a matrix $B \in \Z^{d \times d}$
and vector $c \in \Z^d$ as its input and not the solution $x$ itself.
However, we can construct a very simple linear system $B^{(n)} x = c^{(n)}$,
where $x^{(n)}$ is the solution, in the following way:
\[
  B^{(n)} = F(n) I_d, \qquad c^{(n)}_k = \sum_{i=0}^k a_{d-i} F(n - i) \text{ for } k ≤ d.
\]
% end periodicity

% ==============================================================================
\section{Multi-Dimensional Golden Ratios and Metallic Means}
% ==============================================================================


%
% Convergence
%


Dividing two consecutive Fibonacci numbers approaches the golden ratio as $n$ increases.
The golden ratio is a solution to the equation $x^2 - x - 1 = 0$.
For higher dimensions, we will encounter similar polynomial equations with higher degree.
The goal of this section is to generalize the relationship between linear
recurrences like the Fibonacci sequence with their respective golden ratio.

\begin{definition}
  The \emph{characteristic polynomial} of a linear recurrence~$F$ with
  nonnegative integer coefficients~$a_0, \dots, a_d$ is defined as
  \[
    p_F(x) = x^{d+1} - a_d x^d - a_{d-1} x^{d-1} - \dots - a_1 x - a_0.
  \]
\end{definition}

% TODO: Why is the characteristic polynomial defined as such, any reason?

\begin{example}
  The characteristic polynomial of the $d$-bonacci sequence is
  \[
    x^{d+1} - x^d - ⋯ - x - 1.
  \]
\end{example}

The root can be considered a generalization of the golden ratio.
If we weaken the requirement that each coefficient $a_i$ is either $0$ or $1$ and
instead allow any nonnegative number $a_i ∈ ℤ_{≥ 0}$, then this can be considered a
generalization of the metallic means.

The question for the higher-order Fibonacci sequence is whether they behave the
same way the classical Fibonacci numbers do.
Most importantly, whether their ratios
\[
  r_n
  := \frac{F(n+1)}{F(n)}
  = \frac{a_0 F(n - d)}{F(n)} + \frac{a₁ F(n - d + 1)}{F(n)} + ⋯ + \frac{a_{d-1} F(n-1)}{F(n)} + 1.
\]
are actually converging to the only positive real root of their characteristic
polynomial $p_F$ or not.
In the following, we will show that this is indeed the case.
First, we rewrite the terms of the equation such that each ratio in the sum can
be rewritten as a product of consecutive ratios $r_{n-i}$:
\begin{align*}
  \frac{F(n - d + i)}{F(n)}
  & = \frac{F(n - d + i + 1)}{F(n - d + i)} \frac{F(n - d + i + 2)}{F(n - d + i + 1)} \dots \frac{F(n-1)}{F(n)} \\
  & = \frac{1}{r_{n - d + i}} · \frac{1}{r_{n - d + i + 1}} · \dots · \frac{1}{r_{n-1}}.
\end{align*}
So we can calculate the ratio $r_n$ using the previous ratios $r_{n-1}, r_{n-2}, …, r_{n-d}$ as follows:
\[
  r_n = 1 + \frac{a_d}{r_{n-1}} + \frac{a_{d-1}}{r_{n-1} r_{n-2}} + ⋯ + \frac{a₀}{r_{n-1} r_{n-2} \dots r_{n-d}}.
\]
Using this equation, we can show that the ratios must be bounded.

\begin{lemma}
  The ratios $r_n$ are bounded between $1$ and $d+1$.
\end{lemma}

\begin{proof}
  The first $d - 1$ ratios are all $1$.
  The ratio $r_d$ is equal to
  \[
    \frac{F(d+1)}{F(d)} = \frac{F(0) + F(1) + ⋯ + F(d)}{F(d)} = \frac{1 + 1 + ⋯ + 1}{1} = d + 1,
  \]
  which clearly satisfies the bounds of this lemma.
  By induction, suppose that the previous ratios $r_{n-1}, r_{n-2}, …, r_{n-d}$
  all satisfy the bound between $1$ and $d+1$.
  From previous consideration, we can reformulate the ratio $r_n$ as follows:
  \[
    r_n = 1 + \frac{a₁}{r_{n-1}} + \frac{a₂}{r_{n-1} r_{n-2}} + \dots + \frac{a_d}{r_{n-1} r_{n-2} \dots r_{n-d}}.
  \]
  Since $r_{n-i} ≤ d+1$, we can bound $r_n$ from below by
  \[
    r_n ≥ 1 + \frac{a₁}{d+1} + \frac{a₂}{(d+1)^2} + \dots + \frac{a_d}{(d+1)^d} ≥ 1
  \]
  and since $r_{n-i} ≥ 1$, we can bound $r_n$ from above by
  \[
    r_n ≤ 1 + \frac{a₁}{1} + \frac{a₂}{1} + \dots + \frac{a_d}{1} ≤ d+1.
  \]
  Hence, $1 ≤ r_n ≤ d+1$ for every $n ≥ 0$.
\end{proof}

\begin{figure}[tbp]
  \centering
  \includestandalone{figures/fibonacci-convergence}
  \caption{
    Illustration of the convergence proof for ratios of Fibonacci numbers.
    The points represent the ratios $r_n$.
    The sequences $s_n$ and $t_n$ are the minimum and maximum from a block of
    consecutive ratios, respectively.
    Both sequences converge towards the same limit $φ$, so the ratios converge
    towards this limit, too.
  }
  \label{fig:fibonacci-convergence}
\end{figure}

Showing that the sequence is monotone would be enough to show the convergence.
However, the sequence is clearly not monotone.
Even the ratios of the original Fibonacci sequence alternate between increasing
and decreasing.
So we cannot possibly prove that the higher-order sequences are monotone.
Instead, we bound the sequence between two other sequences $s_n$ and $t_n$
and show that the two sequences are converging to the same limit.
From the squeeze theorem, it follows that $r_n$ converges to the same limit.
The main idea is illustrated in Figure~\ref{fig:fibonacci-convergence}.
The sequences are
\[
  s_n = \min\{r_n, r_{n-1}, …, r_{n-d} \}, \qquad t_n = \max\{r_n, r_{n-1}, …, r_{n-d}\}
\]
Because $r_n$ clearly lies between the two sequences, so it must converge to the same limit as $s_n$ and $t_n$.
For these sequences, we already know from the previous lemma that they are bounded,
so it only remains to be shown that they are monotone,
where $s_n$ is always increasing and $t_n$ is decreasing.

\begin{lemma}
  The sequences $s_n$ and $t_n$ are monotone.
\end{lemma}

\begin{proof}
  Each ratio can be represented as a convex combination of the previous ratios, i.e.
  \[
    r_{n+1} = λ₀ r_n + λ₁ r_{n-1} + \dots + λ_d r_{n-d}
  \]
  using $λ_i = F(n - i) / F(n + 1)$.
  To show that this is indeed a convex combination, all coefficients $λ_i$
  need to be nonnegative and $λ₀ + λ₁ + \dots + \lambda_d = 1$.
  The former follows from the fact that Fibonacci numbers are always increasing,
  while the latter follows simply from the definition of the Fibonacci numbers.
  Because $s_n$ is the minimum and $t_n$ the maximum of $r_n, r_{n-1}, …, r_{n-d}$,
  we can bound the next maximum by
  \[
    t_{n+1} ≤ r_{n+1} = λ₀ r_n + λ₁ r_{n-1} + \dots + λ_d r_{n-d} ≤ λ₀ t_n + λ₁ t_n + ⋯ + λ_d t_n = t_n.
  \]
  and the next minimum by
  \[
    s_{n+1} ≥ r_{n+1} = λ₀ r_n + λ₁ r_{n-1} + \dots + λ_d r_{n-d} ≥ λ₀ s_n + λ₁ s_n + ⋯ + λ_d s_n = s_n.
  \]
  Therefore, $s_n ≤ s_{n+1} ≤ t_{n+1} ≤ t_n$.
\end{proof}

\begin{lemma}
  The sequences $s_n$ and $t_n$ are converging to the same limit.
\end{lemma}

% TODO: Finish this proof
\begin{proof}
  For a contradiction, suppose there exists some $δ > 0$ such that $t_n - s_n > δ$ for every $n ≥ 0$.
  Out of the previous ratios, there must be one ratio $r_k$ exactly equal to $t_n$.
  Therefore,
  \begin{align*}
    s_{n+1} ≥ r_n & = λ₀ r_{n-d-1} + λ₁ r_{n-d} + ⋯ + λ_d r_{n-1} \\
                  & ≥ λ_k t_n + \sum_{i ≠ k} λ_i s_n \\
                  & = λ_k t_n + (1 - λ_k) s_n = s_n + λ_k (t_n - s_n) ≥ s_n + λ_k δ.
  \end{align*}
  We have
  \[
    λ_k = \frac{F(n+k)}{F(n+d+1)} = \frac{1}{r_{n+k} r_{n+k+1} \dots r_{n+d+1}} ≥ \frac{1}{(d+1)^{d+1-k}}.
  \]
  Hence, $λ_k$ is always greater than some constant $c > 0$ for every $k ≥ 0$.
  But then
  \[
    s_{n+i} ≥ s_{n+i-1} + c δ ≥ s_{n+i-2} + 2c δ ≥ \dots ≥ s_n + i c δ
  \]
  and $s_{n+i}$ would always increase as $i$ approaches infinity,
  which contradicts the previous lemma.
  Therefore, $δ = 0$ and it follows that $s_n$ and $t_n$ are approaching the same limit.
\end{proof}

% TODO: Show that this converges! We're still missing the convergence criteria
\begin{theorem}
  Let $F$ be a linear recurrence with coefficients $c_0, \dots, c_d ≥ 0$
  and let $φ$ be the real positive root of its characteristic polynomial.
  Then,
  \[
    \lim_{n \to \infty} \frac{F(n + 1)}{F(n)} = φ.
  \]
\end{theorem}

\begin{proof}
  By the previous lemma, the ratios $r_n$ approach some limit $r ∈ ℝ$. It follows:
  \[
    r
    = \lim_{n → ∞} r_n
    = \lim_{n → ∞} 1 + \frac{c_d}{r_{n-1}} + \frac{c_{d-1}}{r_{n-1} r_{n-2}} + ⋯ + \frac{a₀}{r_{n-1} r_{n-2} \dots r_{n-d}}.
  \]
  Hence, each denominator in the sum approaches $r^i$,
  which results in the following polynomial:
  \[
    r = 1 + \sum_{i = 1}^d \frac{c_{d - i}}{r^i}
    \iff
    r^{d+1} = c₀ + c₁ r + \dots + c_d r^d,
  \]
  which directly corresponds to a root of its characteristic polynomial.
  Furthermore, the ratios are always positive, so $r = φ$.
\end{proof}

\begin{corollary}
  The ratios $F(n + i) / F(n)$ converge to $φ^i$ for $i > 1$.
\end{corollary}


%
% Periodicity
%


The previous theorem leads us straight to an algebraic solution vector $x$,
for which the generalized Euclidean algorithm is periodic.
We simply use the previous vector $x^{(n)}$ defined for the Fibonacci sequence
and increase $n$ towards infinity:
\begin{align*}
  x_i
  & = \lim_{n → ∞} x_i^{(n)} \\
  & = \lim_{n → ∞} \frac{F(n - i)}{F(n)} + \sum_{k=1}^{i-1} c_{d-k} \lim_{n → ∞} \frac{F(n - k)}{F(n)} \\
  & = φ^{d-i} + \sum_{k=1}^{i-1} c_{d-k} φ^{d-k}.
\end{align*}

\begin{theorem}
  Let $φ$ be the root of a polynomial $x^{d+1} - c_d x^d - ⋯ - c₁ x - c₀$
  with positive integers as coefficients.
  Then, the generalized Euclidean algorithm is periodic for $x = (φ, φ^2, …, φ^d)$.
\end{theorem}

% TODO: Finish this proof
\begin{proof}
  We pivot with $ℓ = 1, 2, …, d$ twice.
  In the first round, we get a vector $x'$ with
  \[
    x_i' = ...
  \]
  Once we have the vector $x'$, applying the generalized Euclidean algorithm
  will produce the vector $x''$ with
  \[
    x_ℓ'' = …, x_i'' = …
  \]
  So the algorithm just rotates the elements one spot to the right.
  Applying the algorithm $d$ times with the indices $1, 2, …, d$
  amounts to a complete rotation where each value ends up where it started.
  Therefore, we have reached $x'$ again and the algorithm becomes periodic.
\end{proof}
%end{periodicity}
