\chapter{Higher-Order Fibonacci Numbers and their Golden Ratios}
\label{ch:fibonacci}

% TODO: Add reference to Fibonacci numbers in the continued fraction chapter
One of the simplest periodic continued fraction is $[1; \overline{1}]$.
This fraction evaluates to the golden ratio and its convergents are ratios of
consecutive Fibonacci numbers.
Naturally, we can consider the simplest vectors $x ∈ ℝ^d$ for the generalized
Euclidean algorithm, where the integer part in each iteration is $1$.
Such vectors can be seen as a generalization of the golden
ratio to higher dimensions and their approximation can be seen as a
generalization of Fibonacci numbers.
However, there does not exist a single definitive golden ratio,
Since the generalized algorithm allows an additional freedom in the choice of the pivot.
So there are actually multiple different possible definitions.
Some of these are well known, like the supergolden ratio or the plastic ratio,
which are both roots of cubic polynomials.

Since the definition of the golden ratios depends entirely on the choice of our
pivot element $x_ℓ$, we consider two strategies for choosing $x_ℓ$ in this
chapter: First choosing the smallest fractional value $\{x_ℓ\}$ and second
choosing the largest fractional value $\{x_ℓ\}$.
Both of these strategies have a respective golden ratio for which the algorithm
becomes periodic and they each have a corresponding linear recurrence, which
can be seen as a generalization of the Fibonacci numbers.
In the end, we will derive a general definition of higher-order Fibonacci
sequences and show that the generalized Euclidean algorithm is periodic for
their golden ratios.

% ==============================================================================
\section{The Classical Case: Fibonacci Numbers and the Golden Ratio}
% ==============================================================================

We revisit the classical case of Fibonacci numbers and the golden ratio
to understand their relationship with the Euclidean algorithm.
Fibonacci numbers are a recursive sequence.
Starting with the initial conditions $F(0) = 1$ and $F(1) = 1$,
the remaining terms are calculated using the formula
\[
  F(n) = F(n-1) + F(n-2).
\]
The first terms of this sequence are $1, 1, 2, 3, 5, 8, 13, 21, …$

Their relationship with the Euclidean algorithm becomes apparent when analyzing
the runtime of the algorithm.
In fact, the analysis was actually one of the first practical application of
the Fibonacci numbers.
Lamé \cite{Lame44} used the Fibonacci numbers to show that the number of
iterations in the Euclidean algorithm is bounded by the number of digits in the
input.
The proof is considered by some as the beginning of computational
complexity theory.

\begin{theorem}
  \label{thm:lame}
  If the Euclidean algorithm requires $n$ steps for $(a, b) ∈ ℤ_{> 0}^2$ with $a < b$,
  then $a ≥ F(n+2)$ and $b ≥ F(n+1)$.
\end{theorem}

\begin{proof}
  For $n = 0$, we have $F(2) = 2$ and $F(2) = 1$
  and they are the smallest pair of positive integers which require one step of
  the Euclidean algorithm.
  In fact, they are the smallest pair which satisfy $a < b$.
  So any pair, which takes only one step, must satisfy $a ≥ F(2)$ and $b ≥ F(1)$.
  Suppose that the theorem holds for some $n ≥ 0$.
  Let $(a, b)$ be an input which requires $n+1$ steps.
  Then, $a = qb + r$ for some integers $q, r ≥ 1$.
  For the pair $(b, r)$, the algorithm requires $n$ steps, so $b ≥ F(n+2)$ and
  $r ≥ F(n+1)$ by induction.
  But then
  \[
    a = qb + r ≥ F(n+2) + F(n+1) = F(n+3).
  \]
  Therefore, the theorem also holds for $n+1$.
\end{proof}

The theorem also follows easily using the continued fraction of the ratios
between Fibonacci numbers.
Given a finite continued fraction $[a₀; a₁, …, a_n]$, the Euclidean algorithm
requires $n$ steps for any input $(a, b)$ with the same ratio $a/b$ as the
continued fraction.
Since $[1; 1, …, 1] = F(n+1)/F(n)$ for some $n ≥ 0$, the Euclidean algorithm
takes at least $n$ steps for two consecutive Fibonacci numbers.
Furthermore, Fibonacci numbers are the smallest numbers which require $n$ steps
since we can only increase the coefficients of the continued fraction.

The continued fractions also show the connection between the Fibonacci numbers
and the golden ratio.
The convergents of the continued fraction $[1; \overline{1}]$ are ratios
between consecutive Fibonacci numbers $F(n+1)/F(n)$ and as $n$ approaches
infinity the convergents tend towards the golden ratio $φ$.

\iffalse
\begin{example}
  Consider $a = 13$ and $b = 8$.
  The algorithm proceeds as follows:
  \[
    \begin{array}{rclcrcl}
      13/8 & = & 1 & · & 5/8 & + & 3/8 \\
       5/8 & = & 1 & · & 3/8 & + & 2/8 \\
       3/8 & = & 1 & · & 2/8 & + & 1/8 \\
       2/8 & = & 2 & · & 1/8 & + & 0.
    \end{array}
  \]
\end{example}
\fi

\begin{theorem}
  $\lim_{n → ∞} \frac{F(n+1)}{F(n)} = φ$.
\end{theorem}

\begin{proof}
  First, to show that the continued fraction $[1; 1, …, 1]$ actually evaluates
  to the ratio of consecutive Fibonacci numbers, we use the formula from
  Lemma~\ref{lem:cf-wallis}:
  \[
    p_n = a_n p_{n-1} + p_{n-2}, q_n = a_n q_{n-1} + q_{n-2}.
  \]
  Because $a_n = 1$ for every $n ≥ 0$ and $p_{-1} = 1, p_{-2} = 0$,
  the Fibonacci sequence and the sequence $p_n$ are the same.
  This is also true for $q_n$, but $q_{-1} = 0$ and $q_{-2} = 1$, so the sequence lags one step behind $p_n$.
  Therefore, the convergents are actually $F(n+1)/F(n)$.
  The convergence is already given by Lemma~\vref{lem:cf-approx},
  so all that remains to be shown is that they actually converge to the golden ratio $φ$.
  Suppose they converge to some different limit $φ'$
  \[
    φ' = \lim_{n → ∞} \frac{F(n+1)}{F(n)} = \lim_{n → ∞} 1 + \frac{F(n-1)}{F(n)} = 1 + \frac{1}{φ'}.
  \]
  Multiplying this equation by $φ'$ results in the defining polynomial of the golden ratio $φ$.
  Because the ratios are always positive, we must have $φ' = φ$.
\end{proof}

% TODO: Metallic means

\begin{example}
  Let $φ$ be the golden ratio,
  which satisfies $φ^2 - φ - 1 = 0$
  and has an approximate value of $1.618$.
  The algorithm proceeds as follows:
  \[
    \begin{array}{rclcrcl}
      φ & = & 1 & · & 1   & + & φ - 1 \\
         1 & = & 1 & · & (φ - 1) & + & (2 - φ) \\
       φ - 1 & = & 1 & · & (2 - φ) & + & (2φ - 3) \\
       2 - φ & = & 1 & · & (2φ - 3) & + & (5 - 3φ) \\
       & \vdots &
    \end{array}
  \]
\end{example}

In summary,
the defining property of Fibonacci numbers with respect to the Euclidean
algorithm is that they represent the worst-case for the algorithm.
At each step, they have a quotient of $1$, so they decrease slower than any other pair of integers.

% ==============================================================================
\section{Higher-Order Fibonacci Numbers for the Minimum Strategy}
% ==============================================================================

% TODO: There should be a discussion on what it even means to have a Fibonacci number in higher dimensions
% TODO: We should also discuss the thing about idempotence under the choice of the pivot.
% TODO: Should we have a discussion about why we choose this particular linear system.
% TODO: The discussion about the linear system should go in the generalized Euclidean algorithm chapter

For the generalisation of Fibonacci numbers with respect to the generalized
Euclidean algorithm,
we must find a sequence which similarly has a quotient of $1$ at each iteration.
However, the problem is that no single definitive sequence can exist.
With the generalized Euclidean algorithm we have an additional choice with the
element we choose to pivot with.
Therefore, multiple different notions of Fibonacci numbers exist for this
algorithm.

% I would like a better explanation of what the goal of this section is
We begin by deriving the Fibonacci numbers for one particular strategy.
Recall that the determinant decreases by $\{x_ℓ\}$ in each iteration.
So the first strategy one may think of is to choose the index $ℓ$ with the
smallest fractional value.
After all, this gives us the largest decrease in the determinant over one iteration.
Locally, this would be the highest decrease we can achieve.
So we begin with this strategy and see how the Fibonacci numbers are defined.

% TODO: Actually explain how we derive the Fibonacci numbers for this strategy.
% TODO: Should we have a table for the Fibonacci numbers?
% TODO: What about adding references to their OEIS number?

% TODO: Maybe it's better to show the numbers in the ratios, since we explain
% that they approach some golden ratio anyways
\begin{table}[tbp]
  \caption{The first 10 $d$-bonacci numbers with $d = 1, …, 5$ and their golden ratios.}
  \label{tbl:min-fibonacci}
  \centering
  \input{tables/min-fibonacci}
\end{table}

\begin{definition}
  The Fibonacci numbers for this strategy are defined as
  \begin{enumerate}
    \item $F(0) = F(1) = ⋯ = F(d) = 1$.
    \item $F(n + 1) = F(n) + F(n - 1) + ⋯ + F(n - d)$.
  \end{enumerate}
  For $d = 2, 3$ and $4$, they are also referred to as the Tribonacci, Tetranacci
  and Pentanacci numbers.
  In general, they are known as the $d$-bonacci numbers.
\end{definition}

For these numbers, we use the solution vector
\[
  x =
  \left(
    \frac{F(n)}{F(n + 1)},\;
    \frac{F(n) + F(n - 1)}{F(n + 1)},\;
    ⋯,\;
    \frac{F(n) + F(n - 1) + ⋯ + F(n + 1 - d)}{F(n + 1)}\;
  \right).
\]
The smallest fractional value in this vector is $x₁$, so we pivot with $ℓ = 1$ first.
\begin{align*}
  \{x₁'\}
  & = \left\{\frac{1}{\{x₁\}}\right\}
  = \left\{\frac{F(n + 1)}{F(n)}\right\}
  = \frac{F(n - 1) + ⋯ + F(n - d)}{F(n)}.
\end{align*}
This gives us the value for $x_d$, if we would have started with $F(n)$ instead of $F(n+1)$.
The other values in our input vector $x$ are calculated as follows:
\begin{align*}
  \{xᵢ'\}
  & = \left\{\frac{\{xᵢ\}}{\{x₁\}}\right\} \\
  & = \left\{\frac{F(n) + F(n - 1) + ⋯ + F(n + 1 - i)}{F(n + 1)} · \frac{F(n + 1)}{F(n)}\right\} \\
  & = \frac{F(n - 1) + ⋯ + F(n - d)}{F(n)}.
\end{align*}
So in the next iteration the value $x_i$ has the same value as $x_{i+1}$ if we
would have started with $F(n)$.
Therefore, in the next iteration the smallest fractional value must be $x_2$.
We continue this until we have cycled through all variables.

Another example would be the opposite strategy: Choosing the maximum in each iteration.
In this case, the Fibonacci numbers are defined as
\begin{align*}
  F(0) = \dots = F(d) = 1, \qquad F(n + 1) = F(n) + F(n - d).
\end{align*}

The golden ratios for these numbers is the limit
\[
  φ = \lim_{n → ∞} \frac{F(n + 1)}{F(n)}.
\]

% TODO: There should be a note, that we're taking the actual minimum, so we
% stop once we see any zero. Because at that point, we're cycling.

The following lemma shows that the $\mathrm{pivot}$ operation can also be
viewed as a multi-dimensional division with remainder operation, where we have
a set of integers $p₁, …, p_d$ and divide them by one element $p_ℓ$.

\begin{lemma}
  \label{lem:divmod}
  % TODO: This should basically prove that pivot is just division with
  % remainder
  Let $x ∈ ℚ^d$ and $x' = \mathrm{pivot}_ℓ(x)$ for some index $ℓ$.
  Suppose $x = (p₁/q, p₂/q, …, p_d/q)$ and $x' = (p₁'/q', p₂'/q', …, p_d'/q')$
  with each having at least one irreducible fraction.
  Furthermore, let $x_{(k)} = p_{(k)}/q$ and $x_{(k)}' = p_{(k)}'/q'$ denote
  the $k$-th smallest element in each vector, respectively.
  Then,
  \[
    q ≥ p_{(d)}',
    \qquad
    p_ℓ ≥ a_{(d)} p_{(d)}' + q',
    \qquad
    p_i ≥ a_{(i)} p_{(d)}' + p_{(i)}'
  \]
  for every $i ≤ d - 1$ and $a = \floor{x}$.
\end{lemma}

\begin{proof}
  % TODO: Reference the rule
  By the update rule, we have
  \[
    \frac{p_ℓ'}{q'} = \frac{1}{\frac{p_ℓ}{q} - a_ℓ} = \frac{q}{p_ℓ - a_ℓ q}
  \]
  Therefore, $q = p_ℓ'$ and $p_ℓ = a_ℓ q + q' = a_ℓ p_ℓ' + q'$.
  For the remaining elements $x_i = p_i/q$ with $i ≠ ℓ$, we have
  \[
    \frac{p_i'}{q'} = \frac{\frac{p_i}{q} - a_i}{\frac{p_ℓ}{q} - a_ℓ} = \frac{p_i - a_i q}{p_ℓ - a_ℓ q}.
  \]
  Therefore, $p_i = p_i' + a_i q = p_i' + a_i p_ℓ'$.
\end{proof}

To show that the $d$-bonacci numbers are the worst-case for the minimum
strategy, we first need a few requirements.
The first is that the vector $x$ is strictly positive,
which can be easily solved by ignoring the first iteration.
If $x$ contains any negative values, then applying one step of the algorithm
produces a strictly positive vector.
The second requirement is that the values in $x$ are all different.
The reasoning behind this requirement is that one could easily check if there
are two elements $x_i, x_j$ with $x_i = x_j$.
Pivoting with either $ℓ = i$ or $ℓ = j$ removes the other element from the
vector, since the element will be zero in the next iteration.
With these requirements, we can show that the $d$-bonacci numbers are the worst-case.

\begin{theorem}
  Let $x = (p₁/q, …, p_d/q) ∈ ℚ^d$
  and let $x_{(i)} = p_{(i)}/q$ denote the $i$-th smallest element.
  If the algorithm requires at least $n ≥ 0$ steps for $x$ when taking the
  minimum fractional value at each step, then
  \[
    q ≥ F(n),
    \qquad
    p_{(i)} ≥ \sum_{k = 0}^i F(n - k),
    \text{ for every } i ≤ d.
  \]
\end{theorem}

\begin{proof}
  For $n = d$, we have
  \begin{align*}
    q ≥ F(d) = 1,
    \qquad
    p_{(i)} ≥ \sum_{k=0}^i F(d - k) = i + 1 \text{ for every } i ≤ d.
  \end{align*}
  These bounds are the smallest bounds we can have, since any smaller set of
  integers does not even satisfy $0 < q < p_{σ(1)} < ⋯ < p_{σ(d)}$.
  Furthermore, any other set of numbers requires at least $0$ steps, so
  the theorem holds for $n = d$.

  % TODO: Fix indices
  Suppose the algorithm requires $n$ steps for some input $x' = (p₁'/q', …, p_d'/q')$.
  The particular order of the values in $x'$ does not matter for the strategy.
  Hence, we can assume without loss of generality that $q' < p_2' < p_3' < … < p_d' < p_1'$.
  By induction, $q' ≥ F(n)$ and because $p_1'$ is the largest value,
  \begin{align*}
    p_{σ(1)}' & ≥ \sum_{k=0}^d F(n - k) = F(n + 1).
  \end{align*}
  Similarly, because all other values with $i ≠ 1$ are shifted one place to the
  left, we have
  \begin{align*}
    p_{(i)}' & ≥ \sum_{k=0}^i F(n - k) = \sum_{k=1}^{i+1} F(n + 1 - k) \text{ for } 2 ≤ i ≤ d.
  \end{align*}
  Let $x ∈ ℚ^d$ such that $x' = \mathrm{pivot}_ℓ(x)$ for some index $ℓ$ and $a = \floor{x}$.
  From Lemma~\ref{lem:divmod}, it follows that
  \begin{align*}
    q
    & ≥ p_{(d)}' ≥ F(n+1), \\
    p_{(1)}
    & ≥ a_{(1)} p_{(d)}' + q' ≥ F(n + 1) + F(n) = \sum_{k=0}^1 F(n + 1 - k) \\
    p_{(i)}
    & ≥ a_{(i)} p_{(d)}' + p_{(i)}' ≥ F(n + 1) + ∑_{k=0}^i F(n - k) = ∑_{k=0}^{i+1} F(n + 1 - k).
  \end{align*}
  The permutation $π$ which orders $x$ might not be the same as $σ$.
  However, if two elements are swapped, then we can easily swap the bounds, too.
  Therefore, the theorem also holds for $n+1$.
\end{proof}

% ==============================================================================
\section{Higher-Order Fibonacci Numbers for the Maximum Strategy}
% ==============================================================================

Choose the maximum fractional value, but never the actual maximum value.
The reason behind the latter is that the maximum value is always the previous
pivot element.
Therefore, if we choose the same maximum element, we could end up choosing the
same index over and over again.
Hence, we remove this index from the consideration and only look at the maximum
fractional value without the actual maximum.

If we have a vector $x ∈ ℚ$, then pivoting with this strategy must result in a
vector $x'$, where exactly one value is greater than $1$.
Because $\{x_ℓ\}$ is the maximum, every other element has a smaller fractional
value and $\{x_i\}/\{x_ℓ\}$ is smaller than $1$.
For the analysis, we assume the same for the initial vector $x$.
If $x$ does not satisfy these conditions, then we can iterate once and it has
to satisfy them.

The worst-case for this strategy are called maximum Fibonacci numbers and they
are defined by the following recurrence relation:
\begin{align*}
  F(n) =
  \begin{cases}
    1, & \text{ if } n ≤ 0, \\
    F(n - 1) + F(n - 1 - d), & \text{ if } n > 0.
  \end{cases}
\end{align*}
The first few terms of this sequences for different dimensions are listed in
Table~\ref{tbl:max-fibonacci}.

\begin{table}[tbp]
  \caption{The first 10 Fibonacci numbers for $d = 1, …, 5$ and their respective golden ratio.}
  \label{tbl:max-fibonacci}
  \centering
  \input{tables/max-fibonacci}
\end{table}

To construct the solution vector $x$ for these numbers, we choose a consecutive
ratio of two Fibonacci numbers for each $x_i$, where the index $i$ determines
the distance between the two.
More specifically, we choose the vector
\begin{align*}
  x = \left(
    \frac{F(n-1)}{F(n)},
    \frac{F(n-2)}{F(n)},
    …,
    \frac{F(n-(d-1)}{F(n)},
    \frac{F(n-d) + F(n)}{F(n)} \right).
\end{align*}

This time, we pivot with the largest fractional value, which is $x_1$.
Let $a = \floor{x}$, then the next vector is $x' = (x₁', …, x_d')$ where
the first element is
\begin{align*}
  x_1'
  = \frac{1}{\left\{\frac{F(n-1)}{F(n)}\right\}}
  = \frac{F(n)}{F(n-1)}
  = \frac{F(n-1) + F(n-1-d)}{F(n)},
\end{align*}
the elements with $i ≤ d - 1$ are
\begin{align*}
  x_i'
  = \frac{\frac{F(n-i)}{F(n)}}{\frac{F(n-1)}{F(n)}}
  = \frac{F(n-i)}{F(n-1)}
\end{align*}
and the last element is
\begin{align*}
  x_d'
  = \frac{\frac{F(n-d) + F(n)}{F(n)} - 1}{\frac{F(n-1)}{F(n)}}
  = \frac{F(n-d)}{F(n-1)}.
\end{align*}

\begin{theorem}
  Suppose the Euclidean algorithm requires at least $n$ steps for $x = (p₁/q, …, p_d/q)$
  with $0 < p₁ < ⋯ < p_{d-1} < q < p_d$ when taking the maximum fractional value at each step.
  Then, there exists a permutation $σ$ such that
  \[
    q ≥ F(n+d),
    \qquad
    p_{σ(d)} ≥ F(n + d) + F(n),
    \qquad
    p_{σ(i)} ≥ F(n + i)
    \quad
    \text{ for every } i ≤ d - 1.
  \]
\end{theorem}

\begin{proof}
  For $n = 0$, we have
  \[
    \left(\frac{F(2)}{F(1)}, \frac{F(3)}{F(1)}, …, \frac{F(d+1)}{F(1)} \right)
    = \left(\frac{2}{1}, \frac{3}{1}, …, \frac{d+1}{1} \right).
  \]
  This is the first positive input, which satisfies the ordering and it requires only one step.
  Therefore, any other input that requires one step must be larger.
  Now suppose that the theorem holds for any $n ≥ 0$.
  Let $x ∈ ℚ^d$ and $a = \floor{x}$.
  Suppose that $x' = \mathrm{pivot}_ℓ(x) = (p₁'/q', …, p_d'/q')$ requires at
  least $n$ steps, where $ℓ$ is chosen according to the strategy.
  By induction, there exists a permutation $σ$ such that
  \begin{align*}
    q'        & ≥ F(n),                     \\
    p_{σ(d)}' & ≥ F(n) + F(n - d) = F(n+1), \\
    p_{σ(i)}' & ≥ F(n - i)
    \text{ for every } i ≤ d - 1.
  \end{align*}
  We assume without loss of generality that $σ(i) = i$ and that it orders the elements in increasing order.
  Because $p_{σ(d)}$ is the largest element in $x'$, we have $ℓ = σ(d) = d$.
  However, $x_ℓ$ cannot be the largest element in $x$ because of the strategy.
  Therefore, $a_ℓ = 0$ and there exists another element $x_k$ with $k ≠ ℓ$ and $a_k ≥ 1$.
  Futhermore, that element must come before $x_ℓ$ since $ℓ = d$.
  We can now bound $x$ using $x'$ and Lemma~\ref{lem:divmod}:
  \begin{align*}
    q   & = p_ℓ' ≥ F(n+1), \\
    p_ℓ & = a_ℓ p_ℓ' + q' = q' ≥ F(n) ≥ F((n+1) - 1), \\
    p_k & = a_k p_ℓ' + p_k' ≥ p_ℓ' + p_k' ≥ F(n + 1) + F(n + 1 - (k + 1)), \\
    p_i & = a_k p_ℓ' + p_i' ≥ p_i' ≥ F(n - i) = F((n+1) - (i+1)).
  \end{align*}
  where $i < ℓ = d$ and $i ≠ k$.
  We're missing the bound for $F(n+1) + F(n+1 - d)$ and $F(n + 1 - k)$.
  The former follows from the bound of $p_k$.
  Because $k < ℓ$, we have
  \begin{align*}
    p_k & ≥ F(n + 1) + F(n + 1 - (k + 1)) ≥ F(n+1) + F(n+1 - d).
  \end{align*}
\end{proof}

% ==============================================================================
\section{Combining both Strategies into the Minimax Strategy}
% ==============================================================================

We choose two indices $k, ℓ$ at once such that they minimize $\{\{x_k\}/\{x_ℓ\}\}$.
We pivot with $k$ first to get $x'$, then with $ℓ$ to get $x''$.
It follows that:

\begin{itemize}
  \item $1/\{\{x_ℓ\}/\{x_k\}\}$ is the largest element in $x''$
  \item $\{\{x_ℓ\}/\{x_k\}\}$ is the smallest fractional value in $x'$
  \item $1/\{x_k\}$ is the largest element in $x'$
\end{itemize}

For this strategy, the Fibonacci numbers are defined as
\begin{align*}
  F_0(n) & = F_1(n-1) + F_1(n-2) + ⋯ + F_1(n-d-1), \\
  F_1(n) & = F_0(n-1) + F_0(n-d-1).
\end{align*}

\begin{theorem}
  If the algorithm requires $n ≥ 0$ steps with the minimax strategy,
  then
  \[
    q ≥ F(),
    \qquad
    p_{(i)} ≥ F().
  \]
\end{theorem}

\begin{proof}
  Suppose the algorithm requires $n$ steps for $x''$.
  By induction,
  \[
    q'' ≥ F(),
    \qquad
    p_{(i)}'' ≥ F().
  \]
  By Lemma~\ref{lem:divmod},
  \begin{align*}
    q' & = p_ℓ'' ≥ ?, \\
    p_ℓ' & = a_ℓ' p_ℓ'' + q'' ≥ q'' ≥ ?, \\
    p_i' & = a_i' p_ℓ'' + p_i'' ≥ p_i'' ≥ ?, \\
    p_k' & = a_k' p_ℓ'' + p_k'' ≥ p_ℓ'' + p_k'' ≥ ?.
  \end{align*}
  Again by Lemma~\ref{lem:divmod},
  \begin{align*}
    q & = p_k' ≥ F(n + 1), \\
    p_ℓ & = a_k' p_k' + q' ≥ p_k' + q' ≥ ?, \\
    p_i & = a_i' p_k' + p_i' ≥ p_k' + p_i' ≥ ?.
  \end{align*}
\end{proof}

\begin{definition}
  A linear recurrence with coefficients~$a_0, \dots, a_d ≥ 0$ is an equation of the
  following form:
  \[
    F(n + 1) = a_0 F(n - d) + a_1 F(n - d + 1) + \dots + a_{d-1} F(n - 1) + a_d F(n).
  \]
\end{definition}

\iffalse % determinant
The golden ratio for this sequence also shows up for a different strategy.
When we choose two indices $ℓ$ and $ℓ'$ such that they minimize the ratio
$\{x_{ℓ'}\}/\{x_{ℓ}\}$, then we can bound the decrease of the determinant over
two iterations using the golden ratio $φ$.

% TODO: I feel like this was using $ψ = φ^{-1}$ instead of $φ$.
\begin{theorem}
  The determinant decreases by at least $φ^{d+1}$ over two iterations with $d ≥ 2$.
\end{theorem}

\begin{proof}
  We assume without loss of generality that the vector is sorted in increasing order and
  $0 ≤ x_i ≤ 1$ for every $i ≤ d$.
  For a contradiction, assume the algorithm yields a smaller decrease than $φ^{d+1}$ on input $x$.
  We must have $x_i > φ^{d+1-i}$ for every $i = 1, \dots, d$.
  For the first value, we have $x₁ > φ^d$, because otherwise we have a total decrease of
  \[
    x₁ \left\{ \frac{x₂}{x₁} \right\} ≤ φ^{d-1} - φ^d = φ^{2d+1} < φ^d.
  \]
  Suppose $x_i > φ^{d+1-i}$ and $x_{i+1} ≤ φ^{d-i}$.
  Then we can achieve a total decrease of
  \[
    x_i · \left\{ \frac{x_{i+1}}{x_i} \right\} ≤ x_{i+1} - x_i < φ^{d-i} - φ^{d+1-i} = φ^{2d+1-i} < φ^d.
  \]
  It follows that $x_i > φ^{d+1-i}$ for every $i ≤ d$.
  But then
  \[
    x_d \left\{ \frac{1}{x_d} \right\} ≤ 1 - x_d < 1 - φ = φ^{d+1}.
  \]
  Hence, we achieve a decrease of at least $φ^{d+1}$ over two iterations.
\end{proof}

The bound for this strategy is tight.
We can construct an input that moves arbitrarily close to this bound.
Formally, for every sufficiently small $ε > 0$, we can find an input $x$ which
achieves a decrease of at most $φ^{d+1} - ε$.
The idea is to choose $x_d$ to be just over $φ$ and all other variables as a multiple of $x_d$
such that we have to choose $x_d$.
But choosing $x_d$ only gives us a decrease of $φ^{d+1} - ε$ in total.

% TODO: Explain what sufficiently small means
\begin{theorem}
  For every (sufficiently small) $ε > 0$,
  there exists an input $x ∈ ℝ^d$ with $d ≥ 2$,
  which achieves a decrease in the determinant of exactly $φ^{d+1} - ε$ over two
  iterations.
\end{theorem}

\begin{proof}
  We choose $x_i = φ^{d+1-i} (1 + ε)$ for $i = 1, \dots, d$.
  The strategy chooses between
  \[
    \left\{ \frac{x_{i+1}}{x_i} \right\}
    = \frac{φ^{d-i} (1 + ε)}{φ^{d+1-i} (1 + ε)} - 1 = \frac{1}{φ} - 1,
    \text{ and }
    \left\{ \frac{1}{x_d} \right\}
    = \frac{1}{φ + ε} - 1
  \]
  Clearly, the strategy chooses $x_d$ since its ratio $\{1/x_d\}$ is the smallest.
  Therefore, the total decrease over two iterations is
  \[
    (φ + ε) \left\{ \frac{1}{φ + ε} \right\} = 1 - φ - ε = φ^{d+1} - ε.
    \qedhere
  \]
\end{proof}
\fi % determinant

% begin periodicity
Given, the linear recurrence $F(n + d + 1) = F(n) + a_1 F(n - 1) + \dots + a_d F(n + d)$,
the value for $x_i^{(n)}$ in the solution $x^{(n)}$ is
\begin{equation}
  \label{eq:general-solution}
  x_i^{(n)} = \frac{F(n - i) + \sum_{k=1}^{i-1} a_{d-k} F(n - k)}{F(n)}.
\end{equation}

\begin{lemma}
  Pivoting with the first element of $x^{(n)}$ using the modified update rule yields the vector
  \[
    x' = (x^{(n-1)}_2, x^{(n-1)}_3, \dots, x^{(n-1)}_d, x^{(n-1)}_1).
  \]
\end{lemma}

\begin{proof}
  For $x_1$, we get
  \[
    \begin{aligned}
      \frac{1}{x_1}
      & = \frac{F(n)}{F(n - 1)} \\
      & = a_d + \frac{F(n - d - 1) + a_1 F(n - d - 2) + \dots + a_{d-1} F(n - 2)}{F(n - 1)} \\
      & = a_d + x^{(n-1)}_d.
    \end{aligned}
  \]
  For the other values, we get
  \begin{align*}
    \frac{x_i}{x_1}
    & = \frac{F(n - i) + \sum_{k=1}^{i-1} a_{d-k} F(n - k)}{F(n)} \frac{F(n)}{F(n - 1)} \\
    & = a_{d-1} + \frac{F(n - i) + \sum_{k=2}^{i-1} a_{d-k} F(n - k)}{F(n-1)} \\
    & = x^{(n-1)}_{i+1} \qedhere
  \end{align*}
\end{proof}

\begin{corollary}
  Running the generalized Euclidean algorithm with $x^{(n)}$ as the solution to
  the linear system $B x = c$ requires $n$ steps, if $x^{(n)}_1$ is the
  smallest element in $x^{(n)}$.
\end{corollary}

Of course, the Euclidean algorithm receives a matrix $B \in \Z^{d \times d}$
and vector $c \in \Z^d$ as its input and not the solution $x$ itself.
However, we can construct a very simple linear system $B^{(n)} x = c^{(n)}$,
where $x^{(n)}$ is the solution, in the following way:
\[
  B^{(n)} = F(n) I_d, \qquad c^{(n)}_k = \sum_{i=0}^k a_{d-i} F(n - i) \text{ for } k ≤ d.
\]
% end periodicity

% ==============================================================================
\section{Multi-Dimensional Golden Ratios and Metallic Means}
% ==============================================================================

% begin convergence
Dividing two consecutive Fibonacci numbers approaches the golden ratio as $n$ increases.
The golden ratio is a solution to the equation $x^2 - x - 1 = 0$.
For higher dimensions, we will encounter similar polynomial equations with higher degree.
The goal of this section is to generalize the relationship between linear
recurrences like the Fibonacci sequence with their respective golden ratio.

\begin{definition}
  The \emph{characteristic polynomial} of a linear recurrence~$F$ with
  nonnegative integer coefficients~$a_0, \dots, a_d$ is defined as
  \[
    p_F(x) = x^{d+1} - a_d x^d - a_{d-1} x^{d-1} - \dots - a_1 x - a_0.
  \]
\end{definition}

% TODO: Why is the characteristic polynomial defined as such, any reason?

\begin{example}
  The characteristic polynomial of the $d$-bonacci sequence is
  \[
    x^{d+1} - x^d - ⋯ - x - 1.
  \]
\end{example}

The root can be considered a generalization of the golden ratio.
If we weaken the requirement that each coefficient $a_i$ is either $0$ or $1$ and
instead allow any nonnegative number $a_i ∈ ℤ_{≥ 0}$, then this can be considered a
generalization of the metallic means.

The question for the higher-order Fibonacci sequence is whether they behave the
same way the classical Fibonacci numbers do.
Most importantly, whether their ratios
\[
  r_n
  := \frac{F(n+1)}{F(n)}
  = \frac{a_0 F(n - d)}{F(n)} + \frac{a₁ F(n - d + 1)}{F(n)} + ⋯ + \frac{a_{d-1} F(n-1)}{F(n)} + 1.
\]
are actually converging to the only positive real root of their characteristic
polynomial $p_F$ or not.
In the following, we will show that this is indeed the case.
First, we rewrite the terms of the equation such that each ratio in the sum can
be rewritten as a product of consecutive ratios $r_{n-i}$:
\begin{align*}
  \frac{F(n - d + i)}{F(n)}
  & = \frac{F(n - d + i + 1)}{F(n - d + i)} \frac{F(n - d + i + 2)}{F(n - d + i + 1)} \dots \frac{F(n-1)}{F(n)} \\
  & = \frac{1}{r_{n - d + i}} · \frac{1}{r_{n - d + i + 1}} · \dots · \frac{1}{r_{n-1}}.
\end{align*}
So we can calculate the ratio $r_n$ using the previous ratios $r_{n-1}, r_{n-2}, …, r_{n-d}$ as follows:
\[
  r_n = 1 + \frac{a_d}{r_{n-1}} + \frac{a_{d-1}}{r_{n-1} r_{n-2}} + ⋯ + \frac{a₀}{r_{n-1} r_{n-2} \dots r_{n-d}}.
\]
Using this equation, we can show that the ratios must be bounded.

\begin{lemma}
  The ratios $r_n$ are bounded between $1$ and $d+1$.
\end{lemma}

\begin{proof}
  The first $d - 1$ ratios are all $1$.
  The ratio $r_d$ is equal to
  \[
    \frac{F(d+1)}{F(d)} = \frac{F(0) + F(1) + ⋯ + F(d)}{F(d)} = \frac{1 + 1 + ⋯ + 1}{1} = d + 1,
  \]
  which clearly satisfies the bounds of this lemma.
  By induction, suppose that the previous ratios $r_{n-1}, r_{n-2}, …, r_{n-d}$
  all satisfy the bound between $1$ and $d+1$.
  From previous consideration, we can reformulate the ratio $r_n$ as follows:
  \[
    r_n = 1 + \frac{a₁}{r_{n-1}} + \frac{a₂}{r_{n-1} r_{n-2}} + \dots + \frac{a_d}{r_{n-1} r_{n-2} \dots r_{n-d}}.
  \]
  Since $r_{n-i} ≤ d+1$, we can bound $r_n$ from below by
  \[
    r_n ≥ 1 + \frac{a₁}{d+1} + \frac{a₂}{(d+1)^2} + \dots + \frac{a_d}{(d+1)^d} ≥ 1
  \]
  and since $r_{n-i} ≥ 1$, we can bound $r_n$ from above by
  \[
    r_n ≤ 1 + \frac{a₁}{1} + \frac{a₂}{1} + \dots + \frac{a_d}{1} ≤ d+1.
  \]
  Hence, $1 ≤ r_n ≤ d+1$ for every $n ≥ 0$.
\end{proof}

\begin{figure}[tbp]
  \centering
  \includestandalone{figures/fibonacci-convergence}
  \caption{
    Illustration of the convergence proof for ratios of Fibonacci numbers.
    The points represent the ratios $r_n$.
    The sequences $s_n$ and $t_n$ are the minimum and maximum from a block of
    consecutive ratios, respectively.
    Both sequences converge towards the same limit $φ$, so the ratios converge
    towards this limit, too.
  }
  \label{fig:fibonacci-convergence}
\end{figure}

Showing that the sequence is monotone would be enough to show the convergence.
However, the sequence is clearly not monotone.
Even the ratios of the original Fibonacci sequence alternate between increasing
and decreasing.
So we cannot possibly prove that the higher-order sequences are monotone.
Instead, we bound the sequence between two other sequences $s_n$ and $t_n$
and show that the two sequences are converging to the same limit.
From the squeeze theorem, it follows that $r_n$ converges to the same limit.
The main idea is illustrated in Figure~\ref{fig:fibonacci-convergence}.
The sequences are
\[
  s_n = \min\{r_n, r_{n-1}, …, r_{n-d} \}, \qquad t_n = \max\{r_n, r_{n-1}, …, r_{n-d}\}
\]
Because $r_n$ clearly lies between the two sequences, so it must converge to the same limit as $s_n$ and $t_n$.
For these sequences, we already know from the previous lemma that they are bounded,
so it only remains to be shown that they are monotone,
where $s_n$ is always increasing and $t_n$ is decreasing.

\begin{lemma}
  The sequences $s_n$ and $t_n$ are monotone.
\end{lemma}

\begin{proof}
  Each ratio can be represented as a convex combination of the previous ratios, i.e.
  \[
    r_{n+1} = λ₀ r_n + λ₁ r_{n-1} + \dots + λ_d r_{n-d}
  \]
  using $λ_i = F(n - i) / F(n + 1)$.
  To show that this is indeed a convex combination, all coefficients $λ_i$
  need to be nonnegative and $λ₀ + λ₁ + \dots + \lambda_d = 1$.
  The former follows from the fact that Fibonacci numbers are always increasing,
  while the latter follows simply from the definition of the Fibonacci numbers.
  Because $s_n$ is the minimum and $t_n$ the maximum of $r_n, r_{n-1}, …, r_{n-d}$,
  we can bound the next maximum by
  \[
    t_{n+1} ≤ r_{n+1} = λ₀ r_n + λ₁ r_{n-1} + \dots + λ_d r_{n-d} ≤ λ₀ t_n + λ₁ t_n + ⋯ + λ_d t_n = t_n.
  \]
  and the next minimum by
  \[
    s_{n+1} ≥ r_{n+1} = λ₀ r_n + λ₁ r_{n-1} + \dots + λ_d r_{n-d} ≥ λ₀ s_n + λ₁ s_n + ⋯ + λ_d s_n = s_n.
  \]
  Therefore, $s_n ≤ s_{n+1} ≤ t_{n+1} ≤ t_n$.
\end{proof}

\begin{lemma}
  The sequences $s_n$ and $t_n$ are converging to the same limit.
\end{lemma}

% TODO: Finish this proof
\begin{proof}
  For a contradiction, suppose there exists some $δ > 0$ such that $t_n - s_n > δ$ for every $n ≥ 0$.
  Out of the previous ratios, there must be one ratio $r_k$ exactly equal to $t_n$.
  Therefore,
  \begin{align*}
    s_{n+1} ≥ r_n & = λ₀ r_{n-d-1} + λ₁ r_{n-d} + ⋯ + λ_d r_{n-1} \\
                  & ≥ λ_k t_n + \sum_{i ≠ k} λ_i s_n \\
                  & = λ_k t_n + (1 - λ_k) s_n = s_n + λ_k (t_n - s_n) ≥ s_n + λ_k δ.
  \end{align*}
  We have
  \[
    λ_k = \frac{F(n+k)}{F(n+d+1)} = \frac{1}{r_{n+k} r_{n+k+1} \dots r_{n+d+1}} ≥ \frac{1}{(d+1)^{d+1-k}}.
  \]
  Hence, $λ_k$ is always greater than some constant $c > 0$ for every $k ≥ 0$.
  But then
  \[
    s_{n+i} ≥ s_{n+i-1} + c δ ≥ s_{n+i-2} + 2c δ ≥ \dots ≥ s_n + i c δ
  \]
  and $s_{n+i}$ would always increase as $i$ approaches infinity,
  which contradicts the previous lemma.
  Therefore, $δ = 0$ and it follows that $s_n$ and $t_n$ are approaching the same limit.
\end{proof}

% TODO: Show that this converges! We're still missing the convergence criteria
\begin{theorem}
  Let $F$ be a linear recurrence with coefficients $a_0, \dots, a_d ≥ 0$
  and let $φ$ be the real positive root of its characteristic polynomial.
  Then,
  \[
    \lim_{n \to \infty} \frac{F(n + 1)}{F(n)} = φ.
  \]
\end{theorem}

\begin{proof}
  By the previous lemma, the ratios $r_n$ approach some limit $r$. It follows:
  \[
    r
    = \lim_{n → ∞} r_n
    = \lim_{n → ∞} 1 + \frac{a_d}{r_{n-1}} + \frac{a_{d-1}}{r_{n-1} r_{n-2}} + ⋯ + \frac{a₀}{r_{n-1} r_{n-2} \dots r_{n-d}}.
  \]
  Hence, each denominator in the sum approaches $r^i$,
  which results in the following polynomial:
  \[
    r = a₀ + \sum_{i = 1}^d \frac{a_{d - i}}{r^i}
    \iff
    r^{d+1} = a₀ + a₁ r + \dots + a_d r^d,
  \]
  which directly corresponds to a root of its characteristic polynomial.
  Furthermore, the ratios are always positive, so $r = φ$.
\end{proof}

\begin{corollary}
  For the same recurrence $F$, $\lim_{n → ∞} F(n + i) / F(n) = φ^i$ for $i > 1$.
\end{corollary}
%end{convergence}

%begin{periodicity}
The previous theorem leads us straight to an algebraic solution vector,
for which the generalized Euclidean algorithm is periodic.
We simply use the previous vector $x^{(n)}$ defined for the Fibonacci sequence
and increase $n$ towards infinity:
\begin{align*}
  x_i
  & = \lim_{n → ∞} x_i^{(n)} \\
  & = \lim_{n → ∞} \frac{F(n - i) + \sum_{k=1}^{i-1} a_{d-k} F(n - k)}{F(n)} \\
  & = φ^{d-i} + \sum_{k=1}^{i-1} a_{d-k} φ^{d-k}.
\end{align*}

\begin{theorem}
  The generalized Euclidean algorithm is periodic for $x = (φ, φ^2, …, φ^d)$,
  where $φ$ is the positive root of the polynomial
  \[
    x^{d+1} - a_{d} x^d - ⋯ - a_1 x - a₀
  \]
  with $a_0, a_1, …, a_d ∈ ℤ_{≥ 0}$.
\end{theorem}

\begin{proof}
  We pivot with $ℓ = 1, 2, …, d$ twice.
  In the first round, we get a vector $x'$ with
  \[
    x_i' = ...
  \]
  Once we have the vector $x'$, applying the generalized Euclidean algorithm
  will produce the vector $x''$ with
  \[
    x_ℓ'' = …, x_i'' = …
  \]
  So the algorithm just rotates the elements one spot to the right.
  Applying the algorithm $d$ times with the indices $1, 2, …, d$
  amounts to a complete rotation where each value ends up where it started.
  Therefore, we have reached $x'$ again and the algorithm becomes periodic.
\end{proof}
%end{periodicity}

%begin{inverse golden ratio}
\iffalse
\begin{definition}
  Given a polynomial $p = \sum_{i=0}^n a_i x^n$, its \emph{reciprocal polynomial},
  denoted as $p^*$, is defined as
  \[
    p^*(x) = x^n p(x^{-1}) = a_n + a_{n-1} x + \dots + a_0 x^n.
  \]
\end{definition}

\begin{example}
  The reciprocal of the golden ratio polynomial $x^2 - x - 1$ is
  \begin{align*}
    x^2 + x - 1,
  \end{align*}
  which has a root at $ψ = 1/φ$.
\end{example}

\begin{lemma}
  Let $p$ be a polynomial. Then, $a$ is a root of $p$ if and only if $a^{-1}$ is a root of $p^*$.
\end{lemma}

\begin{proof}
  Let $a$ be a root of $p$. It follows $p^*(a^{-1}) = a^n p(a) = a^n \cdot 0 = 0$.
  Now let $a^{-1}$ be a root of $p^*$. Then $p^*(a^{-1}) = a^n p(a) = 0$.
  By construction, $a$ cannot be zero and therefore we must have $p(a) = 0$.
\end{proof}
\fi
%end{inverse golden ratio}

% ==============================================================================
\iffalse
\section{Metallic Ratios}
% ==============================================================================

The result from the previous section can be generalized to an even larger class
of polynomials by allowing $a_1, a_2, …, a_d ∈ \Z_{≥ 0}$ instead of only binary
values.
The roots of these polynomials can be seen as a generalization of the metallic ratios.
Indeed, for the one-dimensional case the polynomials are
\[
  x^2 - a₁ x - 1,
\]
which characterizes all possible metallic ratios, like the silver ratio ($a₁ = 2$) or
the bronze ratio ($a₁ = 3$).
The generalization considers higher-degree polynomials of the form
\[
  x^{d+1} - a_d x^d - \dots - a_1 x - 1
\]
with nonnegative integer coefficients $a_1, a_2, …, a_d$.
Each of these polynomials has a corresponding linear recurrence,
which can be reconstructed by the characteristic polynomial.
For the linear recurrence,
the ratios of consecutive terms approaches the real positive root of the
polynomial again.
\fi
